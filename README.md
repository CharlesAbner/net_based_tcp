# net_based_tcp
中山大学计算机网络实验-基于tcp的聊天应用设计
# 基于TCP的GUI聊天程序

这是一个为《计算机网络实验》课程设计的Socket通信编程项目。它实现了一个功能相对完善的、基于 TCP 的、带有图形用户界面的多人聊天程序。

## ✨ 主要功能

* **用户系统:** 支持用户注册与登录，用户信息通过 MySQL 数据库持久化存储。
* **多人聊天:** 支持多名用户同时在线，并进行实时群聊。
* **私密单聊:** 支持从在线列表中选择特定用户，发起一对一的私聊。
* **实时更新:** 客户端可实时查看当前在线用户列表。

## 📸 运行截图

*(请在这里替换为你实验报告中的截图)*

| 登录界面 | 注册界面 |
| :---: | :---: |
|  |  |
| **聊天主界面 (私聊/群聊)** |
|  |

## 🛠️ 技术栈与架构

* **语言:** Python
* **GUI:** Tkinter (Python 标准库)
* **数据库:** MySQL 8.0
* **核心技术:**
    * `socket`: 用于实现客户端与服务器之间的 TCP 可靠通信。
    * `threading`:
        * 服务器端：使用多线程为每一个客户端连接创建专门的处理线程，实现并发。
        * 客户端：使用多线程将 GUI 主线程与网络接收子线程分离，防止界面卡死。
* **架构:**
    * **C/S 架构:** 采用中心服务器进行消息转发和用户管理。
    * **视图-控制器分离:** 尝试将 Tkinter 界面 (`*_panel.py`) 与主逻辑 (`main.py`) 分离。

## 🚀 如何运行

在运行本项目前，请确保你已具备以下环境：

* Python 3.x
* MySQL 8.0

#### 1. 克隆仓库

```bash
git clone [你的仓库URL]
cd [你的项目文件夹]
```

#### 2. 安装依赖

本项目依赖 `Pillow` 和 `pymysql`。我们已经提供了 `requirements.txt` 文件：

```bash
pip install -r requirements.txt
```

#### 3. 配置数据库

1.  确保你的 MySQL 8.0 服务正在运行。
2.  **重要:** 项目代码中默认使用的数据库账号为 `root`，密码为 `1234`。如果你的配置不同，请**务必**修改 `chat_db.py` 和 `create_tb.py` 文件中的数据库连接参数。
3.  运行 `create_tb.py` 脚本，在你的数据库中自动创建所需的 `chat` 数据库和 `users` 表。

    ```bash
    python create_tb.py
    ```

#### 4. 启动服务

1.  **先运行服务器:**
    ```bash
    python server.py
    ```
    看到 "服务器启动，等待连接..." 字样表示成功。

2.  **再运行客户端:**
    ```bash
    python main.py
    ```
    你可以运行多个 `main.py` 实例，来模拟多个用户登录和聊天。

## 📁 项目文件结构

```
.
├── server.py           # 服务器主程序 (处理连接、消息转发、线程管理)
├── client.py           # 客户端网络逻辑 (封装socket收发)
├── main.py             # 客户端主程序 (GUI入口, 逻辑控制中心)
|
├── login_panel.py      # 登录界面 (视图)
├── Register_panel.py   # 注册界面 (视图)
├── main_panel.py       # 聊天主界面 (视图)
|
├── chat_db.py          # 数据库操作模块 (封装增删改查)
├── create_tb.py        # 数据库初始化脚本 (仅需运行一次)
|
├── image_resource/     # 存放UI所需的图片资源
├── requirements.txt    # Python 依赖包
└── README.md           # 就是你正在看的这个文件
```

## 📦 自定义应用层协议

为了解决 TCP 的“粘包”问题并区分不同的业务请求，本项目在 TCP 之上定义了一套简单的应用层协议。

1.  **基础消息格式:**
    所有数据（字符串）在发送前，都会先发送一个 4 字节的整数来表示即将发送的数据长度，然后再发送数据本身。

2.  **客户端 -> 服务器 (请求):**
    * `'1' + len(user) + user + len(pass) + pass` : 登录请求
    * `'2' + len(user) + user + len(pass) + pass + ...` : 注册请求
    * `'3' + len(target) + target + len(content) + content` : 发送消息 (target 为 "【群聊】" 或指定用户名)
    * `'4'` : 请求刷新在线列表

3.  **服务器 -> 客户端 (响应/推送):**
    * `'0'` / `'1'` / `'2'` : 登录或注册的响应码 (成功/失败/已存在)
    * `"#!onlinelist#!" + 4字节人数 + len(user1) + user1 + ...` : 推送在线列表
    * `"#!message#!" + len(flag) + flag + len(sender) + sender + len(content) + content` : 推送聊天消息 (flag 为 "group_chat" 或 "private_chat")

## 📈 未来改进 (To-Do)

本项目作为课程实验，功能已基本实现，但仍有许多可以完善的地方：

* [ ] **美化界面:** 使用更现代的 GUI 框架 (如 PyQt, CustomTkinter) 或美化当前的 Tkinter 界面。
* [ ] **显示头像:** 在注册时允许上传头像，并在聊天界面中显示。
* [ ] **本地聊天记录:** 实现客户端本地存储聊天记录的功能。
* [ ] **发送表情:** 完善发送表情包的功能 (目前仅有占位)。
* [ ] **消息样式:** 在聊天框中区分显示自己发送的消息和他人发送的消息（例如使用不同颜色或对齐方式）。

## 👨‍💻 作者

* 李子康 
